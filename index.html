<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PESTAÑAS</title>
    <link rel="stylesheet" href="./bootstrap/css/bootstrap.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            padding: 24px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            background-color: white;
            color: rgb(184, 142, 140);
        }
        .base_page {
            background-image: url('./assets/img/bottom-right.svg'), url('./assets/img/top-right.svg'), url('./assets/img/bottom-left.svg'), url('./assets/img/top-left.svg'), url('./assets/img/horizontals.png'), url('./assets/img/verticals.png'), url('./assets/img/horizontals.png'), url('./assets/img/verticals.png');
            background-position: bottom right, top right, bottom left, top left, top, left, bottom, right;
            background-size: 140px, 140px, 140px, 140px, 100px 2.8px, 2.8px, 100px 2.8px, 2.6px;
            background-repeat: no-repeat, no-repeat, no-repeat, no-repeat, repeat-x, repeat-y, repeat-x, repeat-y;    
            /* min-height: calc(100vh - 48px); */
            /* height: fit-content; */
        }
        .base_title {
            font-size: 40px;
            font-weight: 100;
        }
        .main_open {
            padding-top: 72px;
            padding-bottom: 72px;
        }
        .btn-primary, .btn-primary:hover, .btn-primary:active, .btn-primary:focus, .btn-primary:focus-within {
            background-color:rgb(184, 142, 140);
            color: #FFFFFF;
            outline: none;
            border: none;
            box-shadow: none;
        }
        .forms {
            width: 100%;
            margin: 0 auto;
            max-width: 330px;
        }
        .forms .btn {
            text-align: left;
        }
        .procedure {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .procedure label {
            color: #2C2E35;
        }
        #results {
            width: 100%;
            max-width: 330px;
            display: flex;
            flex-direction: column;
            text-align: left;
            align-items: start;
            font-weight: 400;
            gap: 4px;
            color:rgb(184, 142, 140);
        }
        #results h6 {
            font-size: 20px;
        }
        #results p {
            color:rgb(184, 142, 140);
            font-size: 18px;
            margin: 0;
        }
        .form-check .form-check-input[type="checkbox"]:checked {
            background-color: #DFC6C5;
            border-color: #DFC6C5;
        }
        .label_file {
            position: relative;
            display: flex;
            flex-direction: row;
            gap: 8px;
        }
        .label_file::before {
            content: '';
            width: 24px;
            height: 24px;
            align-items: center;
            display: block;
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%232C2E35' class='bi bi-camera' viewBox='0 0 16 16'%3E%3Cpath d='M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1v6zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2z'/%3E%3Cpath d='M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5zm0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7zM3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z'/%3E%3C/svg%3E");
        }
        #back_button {
            position: absolute;
            margin-top: auto;
            margin-right: auto;
            bottom: 5%;
        }
        footer {
            left: 0;
        }
        
        
    </style>
</head>
<body>
    <div class="container base_page">
        <div id="main_container" class="d-flex flex-column h-100 gap-3 justify-content-center align-items-center">
            <a id="logo"><img src="./assets/img/logo.png" width="300"></a>
            <h1 class="base_title">
                PESTAÑAS
            </h1>
            <div id="results">

            </div>
            <div class="flex-column gap-2 forms" id="procedure" style="display: none;">
                <div id="procedure_1" class="procedure"><button class="btn btn-primary" id="nombre">NOMBRE</button></div>
                <div id="procedure_2" class="procedure"><button class="btn btn-primary" id="consentimiento">CONSENTIMIENTO</button></div>
                <div id="procedure_3" class="procedure"><button class="btn btn-primary" id="inicial_pic">INICIAL PIC</button></div>
                <div id="procedure_4" class="procedure"><button class="btn btn-primary" id="procedimiento">PROCEDIMIENTO</button></div>
            </div>
            <div class="mt-5 d-block w-100"></div>
            <button id="back_button" style="display: none;" class="btn btn-primary">
                Back
            </button>
        </div>
    </div>
    <footer class="position-absolute bottom-0 text-center w-100">
        <p class="mb-0 w-100">DERMABLESS ALL RIGHT RESERVED</p>
    </footer>
<script src="./bootstrap/js/jquery-3.6.3.min.js"></script>
<script src="./bootstrap/js/bootstrap.min.js"></script>
<script>

    
    const padStart = function(text, length = 2, replacedString = '0'){
        let newText = text + '';
        while(newText.length < length){
            newText = replacedString + newText;
        }
        return newText
    }
    const data = {
        datos_generales: {
            nombre: '',
            inicial_pic: null,
            alergia: false,
            notification_de_alergia: false,
            documento_firmado: false,
        },
        procedimiento: {
            label: '',
            tipo_pestanas: '',
            tipo_transicion: '',
        },
        modificacion: {
            label: '',
            tipo_pestanas: '',
            tipo_transicion: '',
        },
        post_service: {
            servicio_adiciona: [],
        },
        details: {},
        anotaciones_generales: '',
        is_modified: false,
    };
    const states = [];
    let isBButtonCreated = false;
    let isCButtonCreated = false;
    let isDButtonCreated = false;
    const onSend = function(){
        alert('SENDING');   
    }

    $(document).ready(function(){

        const update = function(){
            $('#results').html('');
            if(data.datos_generales.nombre){
                $('#results').append(`<h6>${data.datos_generales.nombre}</h6>`)
                $('#results').append(`<p>${data.datos_generales.date}</p>`)
            }
            if(data.datos_generales.inicial_pic){
                $('#results').append(`<p>${data.datos_generales.uploaded_at}</p>`)
            }
            if(data.datos_generales.alergia){
                $('#results').append(`<p>${data.datos_generales.alergia}</p>`)
            } 
            if(data.modificacion.tipo_pestanas){
                $('#results').append(`<p>${data.modificacion.tipo_pestanas} ${data.modificacion.label.toUpperCase()} (MOD)</p>`);

                if(data.modificacion.tipo_transicion){
                    $('#results').append(`<p>${data.modificacion.tipo_transicion}</p>`);
                }
            } else if(data.procedimiento.tipo_pestanas){
                $('#results').append(`<p>${data.procedimiento.tipo_pestanas} ${data.procedimiento.label.toUpperCase()}</p>`);
                
                if(data.procedimiento.tipo_transicion){
                    $('#results').append(`<p>${data.procedimiento.tipo_transicion}</p>`);
                }
            }

            if(data.post_service.productos_mtto && data.post_service.productos_adicionales && data.post_service.servicio_adiciona && data.post_service.servicio_futuro){
                $('#procedure_c').hide();
                showButtonsD();
            } else {
                $('#procedure_d').remove();
                isDButtonCreated = false;
            }
            
            if(states.length){
                $('#back_button').show();
            } else {
                $('#back_button').hide();
            }
        }

        const createCheckbox = function(id, label, container = false){
            return $(`<div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="${id}">
                        <label class="form-check-label" for="${id}">
                            ${label}
                        </label></div>
                        
            ` + (container? `<div id="${id}_container"></div>`: ''));
        }

        const createFileInput = function(id){
            return $(`<label id="${id}_label" class="label_file">Accion de tomar<input id="${id}" type="file" style="visibility: hidden; position: absolute"></label>`);
        }

        const createInput = function(id){
            return $(`<input class="form-control" name="${id}" id="${id}">`)
        }

        const goToModifications = function(isRefill = false){
            $('#procedure_4').show();
            $('#procedimiento').text('MODIFICACION');
            showButtonsB();
        }
        
        const showButtonsB = function(){
            
            if(!isBButtonCreated){
                isBButtonCreated = true;

                $('#procedure').append('<div id="procedure_b" class="procedure"></div>')
                $('#procedure_b').append('<div id="procedure_b_1" class="procedure"><button class="btn btn-primary" id="tipo_de_glue">TIPO DE GLUE</button></div>');
                $('#procedure_b').append('<div id="procedure_b_2" class="procedure"><button class="btn btn-primary" id="maping_pic">MAPING PIC</button></div>');
                $('#procedure_b').append('<div id="procedure_b_3" class="procedure"><button class="btn btn-primary" id="eyes_pic">EYES PIC</button></div>');
                $('#procedure_b').append('<div id="procedure_b_4" class="procedure"><button class="btn btn-primary" id="final_pic">FINAL PIC</button></div>');
                

                $('#tipo_de_glue').click(function(){
                    initTipoDeGlue();
                });

                const initTipoDeGlue = function(){
                    if(document.querySelector('#procedure_b_1_sub')) return;
            
                    let labels = [
                        'Regular',
                        'Antiallergic'
                    ];
                    $('#procedure_b_1').append('<div id="procedure_b_1_sub" class="procedure"></div>');

                    labels.forEach(label => {
                        let el = createCheckbox(toFriendlyID(label), label);
                        $('#procedure_b_1_sub').append(el);
                        $(`#${toFriendlyID(label)}`).click(function(){
                            
                            $('#procedure_b_1').hide();
                            $('#procedure_b_1_sub').remove();
                            
                            data.details.tipo_de_glue = label;
                            states.push(function(){
                                data.details.tipo_de_glue = null;
                                $('#procedure_b_1').show();
                                update();
                                initTipoDeGlue();
                            });

                            update();

                        });
                    });
                }
                $(['maping_pic', 'eyes_pic', 'final_pic']).each(function(i, id){
                    
                    $('#' + id).click(function(){
                        if(!document.getElementById(id + '_file')){
                            $('#' + id).parent().append(createFileInput(id + '_file'));
                            $('#' + id + '_file').change(function(e){

                                if(e.target.files?.[0]){
                                    data.details[id] = e.target.files[0]
                                }
                                $('#' + id).parent().hide();
                                states.push(function(){
                                    data.details[id] = '';
                                    $('#' + id).parent().show();
                                    if(id === 'final_pic'){
                                        $('#procedure_b').show();
                                        $('#procedure_4').show();
                                        $('#procedure_c').remove();
                                        isCButtonCreated = false;
                                    }
                                    update();
                                });
                                if(id === 'final_pic'){
                                    $('#procedure_b').hide();
                                    $('#procedure_4').hide();
                                    showButtonsC();
                                }
                                update();

                            });
                        }
                    });
                });
            }
            

        }
        const showButtonsC = function(){
            
            if(!isCButtonCreated){
                isCButtonCreated = true;

                $('#procedure').append('<div id="procedure_c" class="procedure"></div>')
                $('#procedure_c').append('<div id="procedure_c_1" class="procedure"><button class="btn btn-primary" id="productos_mtto">PRODUCTOS MTTO</button></div>');
                $('#procedure_c').append('<div id="procedure_c_2" class="procedure"><button class="btn btn-primary" id="servicio_adiciona">SERVICIO ADICIONA</button></div>');
                $('#procedure_c').append('<div id="procedure_c_3" class="procedure"><button class="btn btn-primary" id="productos_adicionales">PRODUCTOS ADICIONALES</button></div>');
                $('#procedure_c').append('<div id="procedure_c_4" class="procedure"><button class="btn btn-primary" id="servicio_futuro">SERVICIO FUTURO</button></div>');
                

                $('#productos_mtto').click(function(){
                    let labels = [
                        'Kit Básico 05/25/2022',
                        'Kit Plus',
                        'Productos individuales'
                    ];
                    $('#procedure_c_1').append('<div id="procedure_c_1_sub" class="procedure"></div>');

                    labels.forEach(label => {
                        let el = createCheckbox(toFriendlyID(label), label);
                        $('#procedure_c_1_sub').append(el);
                        $(`#${toFriendlyID(label)}`).click(function(){
                        
                            $('#procedure_c_1').hide();
                            data.post_service.productos_mtto = label;
                            states.push(function(){
                                data.post_service.productos_mtto = '';
                                $('#procedure_c_1').show();
                                $(`#${toFriendlyID(label)}`).prop('checked', false);
                                update();
                            });
                            update();

                        });
                    });
                });
                $('#servicio_adiciona').click(function(){
                    if(document.querySelector('#procedure_c_2_sub'))
                        return;
                    let labels = [
                        'Remoción',
                        'Henna',
                        'Cejas con pinza',
                        'Wax cejas',
                        'Wax labio superior',
                        'Wax barbilla',
                        'Lifting de cejas',
                        'Lifting de pestañas',
                        'Blanqueamiento dental',
                        'Henna',
                    ];
                    $('#procedure_c_2').append('<div id="procedure_c_2_sub" class="procedure"></div>');

                    labels.forEach(label => {
                        let el = createCheckbox(toFriendlyID(label), label);
                        $('#procedure_c_2_sub').append(el);
                        $(`#${toFriendlyID(label)}`).change(function(){
                        
                            if($(this).prop('checked')){
                                data.post_service.servicio_adiciona.push(label);
                            } else {
                                data.post_service.servicio_adiciona.splice(data.post_service.servicio_adiciona.indexOf(label), 1);
                            }
                            // $('#procedure_c_2').remove();
                            update();
                            
                        });
                    });
                    
                    $('#procedure_c_2_sub').append('<p class="mb-0" id="especialista">Especialista</div>');
                    let especialistas = [
                        'Irianys',
                        'Laura',
                        'Cabina',
                    ]

                    especialistas.forEach(label => {
                        let el = createCheckbox(toFriendlyID(label), label);
                        $('#procedure_c_2_sub').append(el);
                        $(`#${toFriendlyID(label)}`).click(function(){
                        
                            data.post_service.especialista = label;  
                            $('#procedure_c_2').hide();
                            states.push(function(){
                                data.post_service.especialista = '';
                                $('#procedure_c_2').show();
                                $('#' + toFriendlyID(label)).prop('checked', false);
                                update();
                            });
                            update();

                        });
                    });

                });

                $('#productos_adicionales').click(function(){
                    if(document.getElementById('productos_adicionales_input')){
                       return; 
                    }
                    $('#procedure_c_3').append(createInput('productos_adicionales_input'));
                    $('#productos_adicionales_input').change(function(){
                        if($(this).val()){
                            let el = this;

                            data.post_service.productos_adicionales = $(this).val();
                            $('#procedure_c_3').hide();
                            states.push(function(){
                                $(el).val(data.post_service.productos_adicionales);
                                data.post_service.productos_adicionales = '';
                                $('#procedure_c_3').show();
                                update();
                            });
                            update();
                        }
                    });
                });

                $('#servicio_futuro').click(function(){
                    if(document.getElementById('servicio_futuro_input')){
                       return; 
                    }
                    $('#procedure_c_4').append(createInput('servicio_futuro_input'));
                    $('#servicio_futuro_input').change(function(){
                        if($(this).val()){
                            let el = this;
                            data.post_service.servicio_futuro = $(this).val();
                            $('#procedure_c_4').hide();
                            states.push(function(){
                                $(el).val(data.post_service.servicio_futuro);
                                data.post_service.servicio_futuro = '';
                                $('#procedure_c_4').show();
                                update();
                            });
                            update();
                        }
                    });
                });
            }
            

        }
        const showButtonsD = function(){
            
            if(!isDButtonCreated){
                isDButtonCreated = true;

                $('#procedure').append('<div id="procedure_d" class="procedure"></div>')
                $('#procedure_d').append('<div id="procedure_d_1" class="procedure"><button class="btn btn-primary" id="anotaciones_generales">ANOTACIONES GENERALES</button></div>');
                $('#procedure_d').append('<div id="procedure_d_2" class="procedure"><button class="btn btn-primary" id="enviar">ENVIAR</button></div>');
                

                $('#anotaciones_generales').click(function(){
                    let labels = [
                        'Muy satisfecha',
                        'Satisfecha',
                        'Conforme',
                        'Inconforme'
                    ];
                    $('#procedure_d_1').append('<div id="procedure_d_1_sub" class="procedure"></div>');

                    labels.forEach(label => {
                        let el = createCheckbox(toFriendlyID(label), label);
                        $('#procedure_d_1_sub').append(el);
                        $(`#${toFriendlyID(label)}`).click(function(){
                        
                            $('#procedure_d_1').hide();
                            data.anotaciones_generales = label;
                            states.push(function(){
                                data.anotaciones_generales = '';
                                $('#procedure_d_1').show();
                                $('#' + toFriendlyID(label)).prop('checked', false);
                                update();
                            });
                            update();

                        });
                    });
                });
                $('#enviar').click(function(){
                    data.sent_at = new Date();
                    onSend();
                });

            }
            

        }
        


        const goToMotives = function(){
            $('#procedure').append('<div id="procedure_6" class="procedure"><button class="btn btn-primary" id="motivos">MOTIVOS</button></div>')
            $('#procedure_4').hide();

            $('#motivos').click(function(){
                if(!document.querySelector('#motive_input')){
                    $('#procedure_6').append('<input name="motivos" id="motive_input">');

                    $('#motive_input').change(function(){
                        if($(this).val()){
                            data.motivos = $(this).val();
                            $('#procedure_6').hide();
                        }
                    });
                }
            });
        }

        const goToTransitions = function(){
            
            if(!document.querySelector('#procedure_7'))
                $('#procedure_4').append('<div id="procedure_7" class="procedure"><button class="btn btn-primary" id="transicion_type">TIPO TRANSICION</button></div>')
            $('#procedure_4_sub').remove();

            $('#procedure_7').append('<div class="procedure" id="procedure_7_sub"></div>');

            let labels = [
                'Matte a Volumen Suave', 
                'Volumen Suave a Medio', 
                'Volumen Medio a Mega', 
                'Mega a Volumen Medio',
                'Volumen Medio a Suave',
                'Volumen Suave a Matte',
                'Volumen Suave a Hibridas',
                'Matte a Hibridas',
                'Hibridas a Matte'
            ];

            labels.forEach(label => {
                let el = createCheckbox(toFriendlyID(label), label);
                $('#procedure_7_sub').append(el);
                $(`#${toFriendlyID(label)}`).click(function(){
                    
                    $('#procedure_4_sub').remove();
                    $('#procedure_7').remove();
                    
                    if(!data.procedimiento.tipo_transicion) 
                        data.procedimiento.tipo_transicion = label;
                    else
                        data.modificacion.tipo_transicion = label;
                    update();

                    goToModifications();

                });
            });

        }

        let toFriendlyID = function(label){
            return label.replace(new RegExp('( )', 'g'), '_').replace(new RegExp('/', 'g'), '_').toLowerCase();
        }

        const goToProcedures = function(){
            if(document.querySelector('#procedure_4_sub')){
                    return;
                }
                let date = new Date();

                let fullSet = createCheckbox('full_set', 'Full set');
                let refill = createCheckbox('refill', 'Refill');
                let halfSet = createCheckbox('half_set', 'Half set');
                let remocion = createCheckbox('remocion', 'Remoción');

                $('#procedure_4').append('<div class="procedure" id="procedure_4_sub"></div>');
                $('#procedure_4_sub').append(fullSet);
                $('#procedure_4_sub').append(refill);
                $('#procedure_4_sub').append(halfSet);
                $('#procedure_4_sub').append(remocion);

                $(['#full_set', '#refill', '#half_set']).each(function(index, item){
                    
                    $(item).change(function(){
                        if($(this).prop('checked')){

                            let type = {
                                '#full_set': 'FULL SET',
                                '#refill': 'REFILL',
                                '#half_set': 'HALF SET',
                            }[item];
                            $('#procedure_4_sub').html('');
                            
                            let labels = ['Matte', 'Hibridas', 'Volumen Suave', 'Volumen Medio', 'Mega Volumen'];

                            $('#procedimiento').text('TIPO PESTANAS');
                            labels.forEach(function(label){
                                $('#procedure_4_sub').append(createCheckbox(toFriendlyID(label), label));
                                $('#' + toFriendlyID(label)).click(function(){

                                    let item = $(this);
                                    if(data.procedimiento.tipo_pestanas){
                                        data.is_modified = true;
                                        data.modificacion.tipo_pestanas = type;
                                        data.modificacion.label = label;
                                        data.modificacion.tipo_transicion = '';
                                        states.push(function(){
                                            data.is_modified = false;
                                            data.modificacion.tipo_pestanas = '';
                                            data.modificacion.label = '';
                                            data.modificacion.tipo_transicion = '';
                                            update();
                                        });
                                    } else {
                                        data.procedimiento.tipo_pestanas = type;
                                        data.procedimiento.label = label;
                                        data.procedimiento.tipo_transicion = '';
                                        states.push(function(){
                                            data.is_modified = false;
                                            data.procedimiento.tipo_pestanas = '';
                                            data.procedimiento.label = '';
                                            data.procedimiento.tipo_transicion = '';
                                            data.modificacion.tipo_pestanas = '';
                                            data.modificacion.label = '';
                                            data.modificacion.tipo_transicion = '';
                                            $('#procedimiento').text('PROCEDIMIENTO');
                                            update();
                                        });
                                    }
                                    
                                    
                                    update();
                                    
                                    goToModifications();
                                    $('#procedure_4_sub').remove();

                                });
                                
                            })
                            
                            let transicion = createCheckbox('transicion', 'Transicion');

                            if(item === '#refill'){
                                $('#procedure_4_sub').append(transicion);
                                $('#transicion').click(function(){

                                    let label = 'TRANSICION';
                                    let item = $(this);
                                    if(data.procedimiento.tipo_pestanas){
                                        data.is_modified = true;
                                        data.modificacion.tipo_pestanas = type;
                                        data.modificacion.label = label;
                                        data.modificacion.tipo_transicion = '';
                                        states.push(function(){
                                            data.is_modified = false;
                                            data.modificacion.tipo_pestanas = '';
                                            data.modificacion.label = '';
                                            data.modificacion.tipo_transicion = '';
                                            item.prop('checked', false);
                                            goToProcedures();
                                            update();
                                        });
                                    } else {
                                        data.procedimiento.tipo_pestanas = type;
                                        data.procedimiento.label = label;
                                        data.procedimiento.tipo_transicion = '';
                                        states.push(function(){
                                            data.is_modified = false;
                                            data.procedimiento.tipo_pestanas = '';
                                            data.procedimiento.label = '';
                                            data.procedimiento.tipo_transicion = '';
                                            data.modificacion.tipo_pestanas = '';
                                            data.modificacion.label = '';
                                            data.modificacion.tipo_transicion = '';
                                            goToProcedures();
                                            $('#procedimiento').text('PROCEDIMIENTO');
                                            update();
                                        });
                                    }
                                    
                                    update();

                                    goToTransitions();
                                });
                            }
                        }
                    });
                })

                $('#remocion').change(function(){
                    let labels = ['Por alergia', 'Nuevas pestañas', 'Inconformidad'];

                    $('#procedimiento').text('TIPO REMOCION');
                    $('#procedure_4_sub').html('');

                    labels.forEach(function(label){
                        $('#procedure_4_sub').append(createCheckbox(toFriendlyID(label), label));
                        
                        $('#' + toFriendlyID(label)).click(function(){
                        
                            let type = 'REMOCION';
                            if(data.procedimiento.tipo_pestanas){
                                data.is_modified = true;
                                data.modificacion.tipo_pestanas = type;
                                data.modificacion.label = label;
                                data.modificacion.tipo_transicion = '';
                            } else {
                                data.procedimiento.tipo_pestanas = type;
                                data.procedimiento.label = label;
                            }
                            
                            update();

                            $('#procedure_4_sub').remove();
                            goToModifications();
                        });
                    })
                });
        }

        const start = function(){
            $('#logo').hide();
            $('#main_container').addClass('main_open');
            $('#main_container').removeClass('justify-content-center');
            $('#procedure').attr('style', 'display: flex;');

            $('#nombre').click(function(){
                if(!document.querySelector('#full_name')){
                    $('#procedure_1').append('<input id="full_name" name="full_name" type="text" class="form-control">')
                    $('#full_name').change(function(){
                        let val = $(this).val();

                        if(val){

                            let date = new Date();
                            data.datos_generales.date = `${padStart(date.getDate())}/${padStart(date.getMonth())}/${date.getFullYear()}`;
                            data.datos_generales.nombre = val;

                            states.push(function(){
                                data.datos_generales.nombre = '';
                                $('#full_name').val(val);
                                $('#procedure_1').show();
                                update();
                            });
                            update();
                          
                            $('#procedure_1').hide();
                        }
                    });
                }
            });

            $('#consentimiento').click(function(){
                if(!document.querySelector('#documento_firmado')){
                    let documento_firmado = $(`<div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="documento_firmado">
                        <label class="form-check-label" for="documento_firmado">
                            Documento Firmado
                        </label>
                    </div>`)
                    let notification_de = $(`<div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="notification_de">
                        <label class="form-check-label" for="notification_de">
                            Notificacion de alergia
                        </label></div>
                        <div id="alergia_container"></div>
                    `);
                    $('#procedure_2').append(documento_firmado, notification_de);

                    $('#notification_de').change(function(){
                        if($(this).prop('checked')){
                            if(!document.querySelector('alergia')){
                                $('#alergia_container').append(`<input id="alergia" name="alergia" type="text" class="form-control">`);
                                $('#alergia').change(function(){
                                    let val = $(this).val();
                                    if(val){
                                        data.datos_generales.documento_firmado = $('#documento_firmado').prop('checked');
                                        data.datos_generales.notification_de_alergia = $('#notification_de').prop('checked');
                                        data.datos_generales.alergia = val;
                                        states.push(function(){
                                            data.datos_generales.documento_firmado = false;
                                            data.datos_generales.notification_de_alergia = false;
                                            data.datos_generales.alergia = '';
                                            $('#alergia').val(val);
                                            $('#procedure_2').show();
                                            update();
                                        });
                                        update();

                                        $('#procedure_2').hide();
                                    }
                                });
                            }
                        } else {
                            $('#alergia').remove();
                        }
                    });
                }
            });

            $('#inicial_pic').click(function(){
                if(!document.getElementById('initial_pic_label')){
                    
                    $('#procedure_3').append(createFileInput('initial_pic'))
                    $('#initial_pic').change(function(e){
                        let file = e.target.files[0];
                        if(file){
                            let date = new Date();
                            let hours = date.getHours();
                            let am = "AM";
                            if(hours > 12){
                                hours -= 12;
                                am = "PM"
                            }

                            data.datos_generales.inicial_pic = file;
                            data.datos_generales.uploaded_at = `${padStart(hours)}:${padStart(date.getMinutes())} ${am}`;
                            $('#procedure_3').hide();
                            states.push(function(){
                                data.datos_generales.inicial_pic = null;
                                $('#initial_pic').val(null);
                                $('#procedure_3').show();
                                update();
                            });
                            update();
                        }
                    });
                } 
            });

            $('#procedimiento').click(function(){
                goToProcedures();
            });

        }

        $('#back_button').click(function(){
            if(states.length){
                let func = states.pop();
                func();
            }
        });

        $('#logo').click(function(){
            start();
        });
    });
</script>
</body>
</html>
