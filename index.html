<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PESTAÑAS</title>
    <link rel="stylesheet" href="./bootstrap/css/bootstrap.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            padding: 16px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            background-color: white;
            color: rgb(184, 142, 140);
        }
        .base_page {
            background-image: url('./assets/img/bottom-right.svg'), url('./assets/img/top-right.svg'), url('./assets/img/bottom-left.svg'), url('./assets/img/top-left.svg'), url('./assets/img/horizontals.png'), url('./assets/img/verticals.png'), url('./assets/img/horizontals.png'), url('./assets/img/verticals.png');
            background-position: bottom right, top right, bottom left, top left, top, left, bottom, right;
            background-size: 140px, 140px, 140px, 140px, 100px 2.8px, 2.8px, 100px 2.8px, 2.6px;
            background-repeat: no-repeat, no-repeat, no-repeat, no-repeat, repeat-x, repeat-y, repeat-x, repeat-y;    
        }
        .base_title {
            font-size: 40px;
            font-weight: 100;
        }
        .btn-primary, .btn-primary:hover, .btn-primary:active, .btn-primary:focus, .btn-primary:focus-within {
            background-color:rgb(184, 142, 140);
            color: #FFFFFF;
            outline: none;
            border: none;
            box-shadow: none;
        }
        .forms {
            width: 100%;
            margin: 0 auto;
            max-width: 330px;
        }
        .forms .btn {
            text-align: left;
        }
        .procedure {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .procedure label {
            color: #2C2E35;
        }
        #results {
            width: 100%;
            max-width: 330px;
            display: flex;
            flex-direction: column;
            text-align: left;
            align-items: start;
            font-weight: 400;
            gap: 4px;
            color:rgb(184, 142, 140);
        }
        #results h6 {
            font-size: 20px;
        }
        #results p {
            color:rgb(184, 142, 140);
            font-size: 18px;
            margin: 0;
        }
        
    </style>
</head>
<body>
    <div class="container base_page">
        <div class="d-flex flex-column h-100 gap-3 justify-content-center align-items-center">
            <a id="logo"><img src="./assets/img/logo.png" width="300"></a>
            <h1 class="base_title">
                PESTAÑAS
            </h1>
            <div id="results">

            </div>
            <div class="flex-column gap-2 forms" id="procedure" style="display: none;">
                <div id="procedure_1" class="procedure"><button class="btn btn-primary" id="nombre">NOMBRE</button></div>
                <div id="procedure_2" class="procedure"><button class="btn btn-primary" id="consentimiento">CONSENTIMIENTO</button></div>
                <div id="procedure_3" class="procedure"><button class="btn btn-primary" id="inicial_pic">INICIAL PIC</button></div>
                <div id="procedure_4" class="procedure"><button class="btn btn-primary" id="procedimiento">PROCEDIMIENTO</button></div>
            </div>
        </div>
    </div>
<script src="./bootstrap/js/jquery-3.6.3.min.js"></script>
<script src="./bootstrap/js/bootstrap.min.js"></script>
<script>

    
    const padStart = function(text, length = 2, replacedString = '0'){
        let newText = text + '';
        while(newText.length < length){
            newText = replacedString + newText;
        }
        return newText
    }
    const data = {
        name: '',
        file: '',
        uploaded_at: null,
        notification_de: false,
        documento_firmado: false,
        alergia: false,
        procedimiento: {
            type: '',
            subType: '',
            label: '',
        },
        modificacion: {
            type: '',
            subType: '',
            label: '',
        },
        is_modified: false,
    };
    let isBButtonCreated = false;
    let isCButtonCreated = false;
    let isDButtonCreated = false;
    const onSend = function(){
        alert('SENDING');   
    }

    $(document).ready(function(){

        const update = function(){
            $('#results').html('');
            if(data.name){
                $('#results').append(`<h6>${data.name}</h6>`)
                $('#results').append(`<p>${data.date}</p>`)
            }
            if(data.file){
                $('#results').append(`<p>${data.uploaded_at}</p>`)
            }
            if(data.alergia){
                $('#results').append(`<p>${data.alergia}</p>`)
            } 
            if(data.modificacion.type){
                $('#results').append(`<p>${data.modificacion.type} ${data.modificacion.label.toUpperCase()} (Mod)</p>`);

                if(data.modificacion.subType){
                    $('#results').append(`<p>${data.modificacion.subType}</p>`);
                }
            } else if(data.procedimiento.type){
                $('#results').append(`<p>${data.procedimiento.type} ${data.procedimiento.label.toUpperCase()}</p>`);
                
                if(data.procedimiento.subType){
                    $('#results').append(`<p>${data.procedimiento.subType}</p>`);
                }
            }

            if(data.productos_mtto && data.productos_plus && data.servicio_adiciona && data.servicio_futuro){
                $('#procedure_c').hide();
                showButtonsD();
            }
        }

        const createCheckbox = function(id, label, container = false){
            return $(`<div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="${id}">
                        <label class="form-check-label" for="${id}">
                            ${label}
                        </label></div>
                        
            ` + (container? `<div id="${id}_container"></div>`: ''));
        }

        const createFileInput = function(id){
            return $(`<label id="${id}_label" class="position-relative">Accion de tomar<input id="${id}" type="file" style="visibility: hidden; position: absolute"></label>`);
        }

        const createInput = function(id){
            return $(`<input class="form-control" name="${id}" id="${id}">`)
        }

        const goToModifications = function(isRefill = false){
            $('#procedure_4').show();
            $('#procedimiento').text('MODIFICACION');
            showButtonsB();
        }
        
        const showButtonsB = function(){
            
            if(!isBButtonCreated){
                isBButtonCreated = true;

                $('#procedure').append('<div id="procedure_b" class="procedure"></div>')
                $('#procedure_b').append('<div id="procedure_b_1" class="procedure"><button class="btn btn-primary" id="tipo_de_glue">TIPO DE GLUE</button></div>');
                $('#procedure_b').append('<div id="procedure_b_2" class="procedure"><button class="btn btn-primary" id="maping_pic">MAPING PIC</button></div>');
                $('#procedure_b').append('<div id="procedure_b_3" class="procedure"><button class="btn btn-primary" id="eyes_pic">EYES PIC</button></div>');
                $('#procedure_b').append('<div id="procedure_b_4" class="procedure"><button class="btn btn-primary" id="final_pic">FINAL PIC</button></div>');
                

                $('#tipo_de_glue').click(function(){
                    let labels = [
                        'Regular',
                        'Antiallergic'
                    ];
                    $('#procedure_b_1').append('<div id="procedure_b_1_sub" class="procedure"></div>');

                    labels.forEach(label => {
                        let el = createCheckbox(toFriendlyID(label), label);
                        $('#procedure_b_1_sub').append(el);
                        $(`#${toFriendlyID(label)}`).click(function(){
                            
                            $('#procedure_b_1').remove();
                            
                            data.tipo_de_glue = label;

                            update();

                        });
                    });
                });
                $(['maping_pic', 'eyes_pic', 'final_pic']).each(function(i, id){
                    
                    $('#' + id).click(function(){
                        if(!document.getElementById(id + '_file')){
                            $('#' + id).parent().append(createFileInput(id + '_file'));
                            $('#' + id + '_file').change(function(e){
                                if(e.target.files?.[0]){
                                    data[id] = e.target.files[0]
                                }
                                $('#' + id).parent().hide();
                                if(id === 'final_pic'){
                                    $('#procedure_b').hide();
                                    $('#procedure_4').hide();
                                    showButtonsC();
                                }
                            });
                        }

                    });
                });
            }
            

        }
        const showButtonsC = function(){
            
            if(!isCButtonCreated){
                isCButtonCreated = true;

                $('#procedure').append('<div id="procedure_c" class="procedure"></div>')
                $('#procedure_c').append('<div id="procedure_c_1" class="procedure"><button class="btn btn-primary" id="productos_mtto">PRODUCTOS MTTO</button></div>');
                $('#procedure_c').append('<div id="procedure_c_2" class="procedure"><button class="btn btn-primary" id="servicio_adiciona">SERVICIO ADICIONA</button></div>');
                $('#procedure_c').append('<div id="procedure_c_3" class="procedure"><button class="btn btn-primary" id="productos_plus">PRODUCTOS+</button></div>');
                $('#procedure_c').append('<div id="procedure_c_4" class="procedure"><button class="btn btn-primary" id="servicio_futuro">SERVICIO FUTURO</button></div>');
                

                $('#productos_mtto').click(function(){
                    let labels = [
                        'Kit Básico 05/25/2022',
                        'Kit Plus',
                        'Productos individuales'
                    ];
                    $('#procedure_c_1').append('<div id="procedure_c_1_sub" class="procedure"></div>');

                    labels.forEach(label => {
                        let el = createCheckbox(toFriendlyID(label), label);
                        $('#procedure_c_1_sub').append(el);
                        $(`#${toFriendlyID(label)}`).click(function(){
                        
                            $('#procedure_c_1').remove();
                            data.productos_mtto = label;
                            update();

                        });
                    });
                });
                $('#servicio_adiciona').click(function(){
                    let labels = [
                        'Remoción',
                        'Henna',
                        'Cejas con pinza',
                        'Wax cejas',
                        'Wax labio superior',
                        'Wax barbilla',
                        'Lifting de cejas',
                        'Lifting de pestañas',
                        'Blanqueamiento dental',
                        'Henna',
                    ];
                    $('#procedure_c_2').append('<div id="procedure_c_2_sub" class="procedure"></div>');

                    labels.forEach(label => {
                        let el = createCheckbox(toFriendlyID(label), label);
                        $('#procedure_c_2_sub').append(el);
                        $(`#${toFriendlyID(label)}`).click(function(){
                        
                            $('#procedure_c_2').remove();
                            data.servicio_adiciona = label;
                            update();

                        });
                    });
                });

                $('#productos_plus').click(function(){
                    if(document.getElementById('productos_plus_input')){
                       return; 
                    }
                    $('#procedure_c_3').append(createInput('productos_plus_input'));
                    $('#productos_plus_input').change(function(){
                        if($(this).val()){
                            data.productos_plus = $(this).val();
                            $('#procedure_c_3').hide();
                            update();
                        }
                    });
                });

                $('#servicio_futuro').click(function(){
                    if(document.getElementById('servicio_futuro_input')){
                       return; 
                    }
                    $('#procedure_c_4').append(createInput('servicio_futuro_input'));
                    $('#servicio_futuro_input').change(function(){
                        if($(this).val()){
                            data.servicio_futuro = $(this).val();
                            $('#procedure_c_4').hide();
                            update();
                        }
                    });
                });
            }
            

        }
        const showButtonsD = function(){
            
            if(!isDButtonCreated){
                isDButtonCreated = true;

                $('#procedure').append('<div id="procedure_d" class="procedure"></div>')
                $('#procedure_d').append('<div id="procedure_d_1" class="procedure"><button class="btn btn-primary" id="anotaciones_generales">ANOTACIONES GENERALES</button></div>');
                $('#procedure_d').append('<div id="procedure_d_2" class="procedure"><button class="btn btn-primary" id="enviar">ENVIAR</button></div>');
                

                $('#anotaciones_generales').click(function(){
                    let labels = [
                        'Muy satisfecha',
                        'Satisfecha',
                        'Conforme',
                        'Inconforme'
                    ];
                    $('#procedure_d_1').append('<div id="procedure_d_1_sub" class="procedure"></div>');

                    labels.forEach(label => {
                        let el = createCheckbox(toFriendlyID(label), label);
                        $('#procedure_d_1_sub').append(el);
                        $(`#${toFriendlyID(label)}`).click(function(){
                        
                            $('#procedure_d_1').remove();
                            data.anotaciones_generales = label;
                            update();

                        });
                    });
                });
                $('#enviar').click(function(){
                    onSend();
                });

                $('#productos_plus').click(function(){
                    if(document.getElementById('productos_plus_input')){
                       return; 
                    }
                    $('#procedure_c_3').append(createInput('productos_plus_input'));
                    $('#productos_plus_input').change(function(){
                        if($(this).val()){
                            data.productos_plus = $(this).val();
                            $('#procedure_c_3').hide();
                            update();
                        }
                    });
                });

                $('#servicio_futuro').click(function(){
                    if(document.getElementById('servicio_futuro_input')){
                       return; 
                    }
                    $('#procedure_c_4').append(createInput('servicio_futuro_input'));
                    $('#servicio_futuro_input').change(function(){
                        if($(this).val()){
                            data.servicio_futuro = $(this).val();
                            $('#procedure_c_4').hide();
                            update();
                        }
                    });
                });
            }
            

        }
        


        const goToMotives = function(){
            $('#procedure').append('<div id="procedure_6" class="procedure"><button class="btn btn-primary" id="motivos">MOTIVOS</button></div>')
            $('#procedure_4').hide();

            $('#motivos').click(function(){
                if(!document.querySelector('#motive_input')){
                    $('#procedure_6').append('<input name="motivos" id="motive_input">');

                    $('#motive_input').change(function(){
                        if($(this).val()){
                            data.motivos = $(this).val();
                            $('#procedure_6').hide();
                        }
                    });
                }
            });
        }

        const goToTransitions = function(){
            
            if(!document.querySelector('#procedure_7'))
                $('#procedure').append('<div id="procedure_7" class="procedure"><button class="btn btn-primary" id="transicion_type">TIPO TRANSICION</button></div>')
            $('#procedure_4').hide();

            $('#procedure_7').append('<div class="procedure" id="procedure_7_sub"></div>');

            let labels = [
                'Matte a Volumen Suave', 
                'Volumen Suave a Medio', 
                'Volumen Medio a Mega', 
                'Mega a Volumen Medio',
                'Volumen Medio a Suave',
                'Volumen Suave a Matte',
                'Volumen Suave a Hibridas',
                'Matte a Hibridas',
                'Hibridas a Matte'
            ];

            labels.forEach(label => {
                let el = createCheckbox(toFriendlyID(label), label);
                $('#procedure_7_sub').append(el);
                $(`#${toFriendlyID(label)}`).click(function(){
                    
                    $('#procedure_4_sub').remove();
                    $('#procedure_7').remove();
                    
                    if(!data.procedimiento.subType) 
                        data.procedimiento.subType = label;
                    else
                        data.modificacion.subType = label;
                    update();

                    goToModifications();

                });
            });

        }

        let toFriendlyID = function(label){
            return label.replace(new RegExp('( )', 'g'), '_').replace(new RegExp('/', 'g'), '_').toLowerCase();
        }

        const start = function(){
            $('#logo').hide();
            $('#procedure').attr('style', 'display: flex;');

            $('#nombre').click(function(){
                if(!document.querySelector('#full_name')){
                    $('#procedure_1').append('<input id="full_name" name="full_name" type="text" class="form-control">')
                    $('#full_name').change(function(){
                        let val = $(this).val();

                        if(val){

                            let date = new Date();
                            data.date = `${padStart(date.getDate())}/${padStart(date.getMonth())}/${date.getFullYear()}`;
                            data.name = val;
                            update();
                          
                            $('#procedure_1').remove();
                        }
                    });
                }
            });

            $('#consentimiento').click(function(){
                if(!document.querySelector('#documento_firmado')){
                    let documento_firmado = $(`<div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="documento_firmado">
                        <label class="form-check-label" for="documento_firmado">
                            Documento Firmado
                        </label>
                    </div>`)
                    let notification_de = $(`<div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="notification_de">
                        <label class="form-check-label" for="notification_de">
                            Notificacion de Alergia
                        </label></div>
                        <div id="alergia_container"></div>
                    `);
                    $('#procedure_2').append(documento_firmado, notification_de);

                    $('#notification_de').change(function(){
                        if($(this).prop('checked')){
                            if(!document.querySelector('alergia')){
                                $('#alergia_container').append(`<input id="alergia" name="alergia" type="text" class="form-control">`);
                                $('#alergia').change(function(){
                                    let val = $(this).val();
                                    if(val){
                                        data.documento_firmado = $('#documento_firmado').prop('checked');
                                        data.notification_de = $('#notification_de').prop('checked');
                                        data.alergia = val;
                                        update();

                                        $('#procedure_2').remove();
                                    }
                                });
                            }
                        } else {
                            $('#alergia').remove();
                        }
                    });
                }
            });

            $('#inicial_pic').click(function(){
                if(!document.getElementById('pic_text')){
                    
                    $('#procedure_3').append('<label id="pic_text" class="position-relative">Accion de tomar<input id="initial_pic_file" type="file" style="visibility: hidden; position: absolute"></label>')
                    $('#initial_pic_file').change(function(e){
                        let file = e.target.files[0];
                        if(file){
                            let date = new Date();
                            let hours = date.getHours();
                            let am = "AM";
                            if(hours > 12){
                                hours -= 12;
                                am = "PM"
                            }

                            data.file = file;
                            data.uploaded_at = `${padStart(hours)}:${padStart(date.getMinutes())} ${am}`;
                            $('#procedure_3').remove();
                            update();
                        }
                    });
                } 
            });

            $('#procedimiento').click(function(){

                if(document.querySelector('#procedure_4_sub')){
                    return;
                }
                let date = new Date();

                let fullSet = createCheckbox('full_set', 'Full set');
                let refill = createCheckbox('refill', 'Refill');
                let halfSet = createCheckbox('half_set', 'Half set');
                let remocion = createCheckbox('remocion', 'Remoción');

                $('#procedure_4').append('<div class="procedure" id="procedure_4_sub"></div>');
                $('#procedure_4_sub').append(fullSet);
                $('#procedure_4_sub').append(refill);
                $('#procedure_4_sub').append(halfSet);
                $('#procedure_4_sub').append(remocion);

                $(['#full_set', '#refill', '#half_set']).each(function(index, item){
                    
                    $(item).change(function(){
                        if($(this).prop('checked')){

                            let type = {
                                '#full_set': 'FULL SET',
                                '#refill': 'REFILL',
                                '#half_set': 'HALF SET',
                            }[item];
                            $('#procedure_4_sub').html('');
                            
                            let labels = ['Matte', 'Hibridas', 'Volumen Suave', 'Volumen Medio', 'Mega Volumen'];

                            $('#procedimiento').text('TIPO PESTANAS');
                            labels.forEach(function(label){
                                $('#procedure_4_sub').append(createCheckbox(toFriendlyID(label), label));
                                $('#' + toFriendlyID(label)).click(function(){

                                    if(data.procedimiento.type){
                                        data.is_modified = true;
                                        data.modificacion.type = type;
                                        data.modificacion.label = label;
                                        data.modificacion.subType = '';
                                    } else {
                                        data.procedimiento.type = type;
                                        data.procedimiento.label = label;
                                        data.procedimiento.subType = '';
                                    }
                                    
                                    update();
                                    
                                    goToModifications();
                                    $('#procedure_4_sub').remove();

                                });
                                
                            })
                            
                            let transicion = createCheckbox('transicion', 'Transicion');

                            if(item === '#refill'){
                                $('#procedure_4_sub').append(transicion);
                                $('#transicion').click(function(){

                                    let label = 'TRANSICION';
                                    if(data.procedimiento.type){
                                        data.is_modified = true;
                                        data.modificacion.type = type;
                                        data.modificacion.label = label;
                                        data.modificacion.subType = '';
                                    } else {
                                        data.procedimiento.type = type;
                                        data.procedimiento.label = label;
                                        data.procedimiento.subType = '';
                                    }
                                    
                                    update();

                                    goToTransitions();
                                });
                            }
                        }
                    });
                })

                $('#remocion').change(function(){
                    let labels = ['Por alergia', 'Nuevas pestañas', 'Inconformidad'];

                    $('#procedimiento').text('TIPO REMOCION');
                    $('#procedure_4_sub').html('');

                    labels.forEach(function(label){
                        $('#procedure_4_sub').append(createCheckbox(toFriendlyID(label), label));
                        
                        $('#' + toFriendlyID(label)).click(function(){
                        
                            let type = 'REMOCION';
                            if(data.procedimiento.type){
                                data.is_modified = true;
                                data.modificacion.type = type;
                                data.modificacion.label = label;
                                data.modificacion.subType = '';
                            } else {
                                data.procedimiento.type = type;
                                data.procedimiento.label = label;
                            }
                            
                            update();

                            $('#procedure_4_sub').remove();
                            goToModifications();
                        });
                    })
                });
            });

        }

        $('#logo').click(function(){
            start();
        });
    });
</script>
</body>
</html>
